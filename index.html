<!DOCTYPE html><html><head><title>ESP32 GPS Map BLE</title><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/><style>html,body{margin:0;padding:0;height:100%;width:100%}#map{height:100%;width:100%;z-index:1}#buttons{position:fixed;top:10px;left:50%;transform:translateX(-50%);z-index:9999;background:rgba(255,255,255,.95);padding:8px 12px;border-radius:10px;display:flex;gap:10px;box-shadow:0 2px 6px rgba(0,0,0,.2)}#buttons button{padding:10px 18px;font-size:15px;border:none;border-radius:6px;cursor:pointer;font-weight:bold}#connectBtn{background-color:#28a745;color:white}#disconnectBtn{background-color:#dc3545;color:white}#clearBtn{background-color:#ffc107;color:black}#followBtn{background-color:#007bff;color:white}</style></head><body><div id="buttons"><button id="connectBtn">Connect ESP32 BLE</button><button id="disconnectBtn">Disconnect</button><button id="clearBtn">Clear Trail</button><button id="followBtn">Follow: ON</button></div><div id="map"></div><script src="https://unpkg.com/leaflet/dist/leaflet.js"></script><script>var _0x5f8b=["map","setView","scrollWheelZoom","enable","touchZoom","doubleClickZoom","boxZoom","keyboard","tileLayer","https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png","attribution","&copy; OpenStreetMap contributors","getElementById","connectBtn","addEventListener","click","requestDevice","filters","name","LoRaGPS","optionalServices","12345678-1234-1234-1234-1234567890ab","gatt","connect","getPrimaryService","abcd1234-5678-90ab-cdef-1234567890ab","getCharacteristic","startNotifications","characteristicvaluechanged","split","\n","includes",",","parseFloat","trim","marker","bindPopup","openPopup","push","polyline","setLatLngs","setView","panTo","animate",!0,"Disconnected from ESP32 BLE!","disconnect","disconnectBtn","clearBtn","Follow: ON","followBtn","innerText"];let map=L[_0x5f8b[0]]("map",{maxBounds:[[34.8,19],[42,28.5]],maxBoundsViscosity:1})._0x5f8b[1]([37.9838,23.7275],7);map[_0x5f8b[2]][_0x5f8b[3]](),map[_0x5f8b[4]][_0x5f8b[3]](),map[_0x5f8b[5]][_0x5f8b[3]](),map[_0x5f8b[6]][_0x5f8b[3]](),map[_0x5f8b[7]][_0x5f8b[3]](),L[_0x5f8b[8]](_0x5f8b[9],{attribution:_0x5f8b[11]}).addTo(map);let markerVar,trail=[],polylineVar,follow=!0,bleDeviceVar,gpsChar;document[_0x5f8b[12]][_0x5f8b[13]][_0x5f8b[14]](async()=>{try{bleDeviceVar=await navigator.bluetooth[_0x5f8b[15]]({[_0x5f8b[16]]:[{[_0x5f8b[17]]:_0x5f8b[18]}],[_0x5f8b[19]]:[_0x5f8b[20]]});const serverVar=await bleDeviceVar[_0x5f8b[21]][_0x5f8b[22]](),serviceVar=await serverVar[_0x5f8b[23]](_0x5f8b[20]);gpsChar=await serviceVar[_0x5f8b[24]](_0x5f8b[25]),await gpsChar[_0x5f8b[26]](),gpsChar.addEventListener(_0x5f8b[27],evt=>{let val=(new TextDecoder).decode(evt.target.value);val.split(_0x5f8b[28]).forEach(line=>{if(line[_0x5f8b[29]](_0x5f8b[30])){let [lat,lng]=line.split(_0x5f8b[30]),latF=parseFloat(lat[_0x5f8b[31]]()),lngF=parseFloat(lng[_0x5f8b[31]]());if(!isNaN(latF)&&!isNaN(lngF)){let pos=[latF,lngF];markerVar?markerVar.setLatLng(pos):markerVar=L.marker(pos).addTo(map).bindPopup("ESP32 GPS").openPopup(),trail.push(pos),polylineVar?polylineVar.setLatLngs(trail):polylineVar=L.polyline(trail,{color:"blue"}).addTo(map),follow?map.getZoom()<7?map[_0x5f8b[1]](pos,10):map.panTo(pos,{animate:!0}):null}}})}),alert("Connected to ESP32 BLE!")}catch(err){console.error(err),alert("BLE connection failed! Make sure ESP32 is advertising and not already connected.")}});document[_0x5f8b[12]][_0x5f8b[13]][_0x5f8b[14]](async()=>{bleDeviceVar&&bleDeviceVar[_0x5f8b[21]].connected&&await bleDeviceVar[_0x5f8b[21]][_0x5f8b[33]](),alert(_0x5f8b[32])}),document[_0x5f8b[12]][_0x5f8b[34]][_0x5f8b[14]](()=>{trail=[],polylineVar&&(map.removeLayer(polylineVar),polylineVar=null)}),document[_0x5f8b[12]][_0x5f8b[35]][_0x5f8b[14]](()=>{follow=!follow,document[_0x5f8b[12]][_0x5f8b[35]][_0x5f8b[36]]="Follow: "+(follow?"ON":"OFF")});</script></body></html>
